
- name: start python service
  ansible.builtin.shell: "source whisper_env/bin/activate && python transcribe_service_redis.py nfs/transcribed-{{ dataset_name }}"
  when: inventory_hostname in groups['workers']

- name: push concatenate script to worker
  ansible.builtin.copy:
    src: /home/almalinux/concatenate.sh # generated by the dataset role with the dataset name
    dest: /home/almalinux/
    owner: almalinux
    group: almalinux
    mode: '0755'
  when: inventory_hostname == groups['workers'][0]

- name: start slurm job
  ansible.builtin.shell: "sbatch --array=1-$(cat nfs/{{ dataset_name }}_filelist | wc -l) preprocess.sh"
  when: inventory_hostname == host

